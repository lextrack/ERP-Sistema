<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="ERP de código libre">
    <meta name="author" content="Lextrack">
    <title>Gestión de Finanzas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="img/favicon.ico" />
    <link rel="stylesheet" href="css/finanzas.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="bg-dark text-white">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top shadow">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="index.html">
                <i class="fa-solid fa-building me-2"></i>
                <span>ERP Sistema</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="index.html">
                            <i class="fa-solid fa-gauge-high me-1"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="inventario.html">
                            <i class="fa-solid fa-boxes-stacked me-1"></i> Inventario
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center" href="clientes.html">
                            <i class="fa-solid fa-users me-1"></i> Clientes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active d-flex align-items-center" aria-current="page" href="finanzas.html">
                            <i class="fa-solid fa-coins me-1"></i> Finanzas
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-2">
        <h2 class="text-center mb-4">Gestión de Finanzas</h2>
        
        <!-- Resumen financiero -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="finance-card card text-white text-center p-4">
                    <div class="card-body">
                        <i class="fas fa-dollar-sign fa-3x mb-3 text-success"></i>
                        <h5 class="card-title">Ingresos</h5>
                        <h3 class="card-text" id="totalIngresos">$0.00</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="finance-card card text-white text-center p-4">
                    <div class="card-body">
                        <i class="fas fa-file-invoice-dollar fa-3x mb-3 text-warning"></i>
                        <h5 class="card-title">Gastos</h5>
                        <h3 class="card-text" id="totalGastos">$0.00</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="finance-card card text-white text-center p-4">
                    <div class="card-body">
                        <i class="fas fa-chart-line fa-3x mb-3 text-info"></i>
                        <h5 class="card-title">Balance</h5>
                        <h3 class="card-text" id="balanceTotal">$0.00</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="finance-card card text-white text-center p-4">
                    <div class="card-body">
                        <i class="fas fa-exchange-alt fa-3x mb-3 text-primary"></i>
                        <h5 class="card-title">Transacciones</h5>
                        <h3 class="card-text" id="totalTransacciones">0</h3>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tabs de finanzas -->
        <ul class="nav nav-tabs" id="finanzasTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="transacciones-tab" data-bs-toggle="tab" 
                        data-bs-target="#transacciones" type="button" role="tab" 
                        aria-controls="transacciones" aria-selected="true">
                    Transacciones
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reportes-tab" data-bs-toggle="tab" 
                        data-bs-target="#reportes" type="button" role="tab" 
                        aria-controls="reportes" aria-selected="false">
                    Reportes
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="facturas-tab" data-bs-toggle="tab" 
                        data-bs-target="#facturas" type="button" role="tab" 
                        aria-controls="facturas" aria-selected="false">
                    Facturas
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="finanzasTabContent">
            <!-- Tab de Transacciones -->
            <div class="tab-pane fade show active" id="transacciones" role="tabpanel" aria-labelledby="transacciones-tab">
                <div class="row mb-3">
                    <div class="col-md-3">
                        <button class="btn btn-success w-100" id="btnNuevoIngreso">
                            <i class="fas fa-plus-circle"></i> Nuevo Ingreso
                        </button>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-warning w-100" id="btnNuevoGasto">
                            <i class="fas fa-minus-circle"></i> Nuevo Gasto
                        </button>
                    </div>
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" id="buscarTransaccion" placeholder="Buscar transacción...">
                            <select class="form-select" id="filtroTipoTransaccion">
                                <option value="todos">Todos</option>
                                <option value="ingreso">Ingresos</option>
                                <option value="gasto">Gastos</option>
                            </select>
                            <button class="btn btn-primary" type="button" id="btnBuscarTransaccion">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-dark table-bordered table-hover" id="tablaTransacciones">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Descripción</th>
                                <th>Categoría</th>
                                <th>Tipo</th>
                                <th>Monto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se cargarán con JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Información de resultados y paginación para transacciones -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <p class="text-white" id="infoResultadosTransacciones">Mostrando 10 de 0 transacciones</p>
                    </div>
                    <div class="col-md-6">
                        <div id="paginacionTransacciones" class="d-flex justify-content-end"></div>
                    </div>
                </div>
            </div>
            
            <!-- Tab de Reportes -->
            <div class="tab-pane fade" id="reportes" role="tabpanel" aria-labelledby="reportes-tab">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="filtroMesReporte" class="form-label">Filtrar por mes:</label>
                            <select class="form-select" id="filtroMesReporte">
                                <option value="0">Enero</option>
                                <option value="1">Febrero</option>
                                <option value="2">Marzo</option>
                                <option value="3">Abril</option>
                                <option value="4">Mayo</option>
                                <option value="5">Junio</option>
                                <option value="6">Julio</option>
                                <option value="7">Agosto</option>
                                <option value="8">Septiembre</option>
                                <option value="9">Octubre</option>
                                <option value="10">Noviembre</option>
                                <option value="11">Diciembre</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="filtroAnioReporte" class="form-label">Filtrar por año:</label>
                            <select class="form-select" id="filtroAnioReporte">
                                <!-- Los años se cargarán con JavaScript -->
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="finance-card card p-3">
                            <h5 class="card-title text-white">Ingresos vs Gastos</h5>
                            <div class="chart-container">
                                <canvas id="ingresosVsGastosChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="finance-card card p-3">
                            <h5 class="card-title text-white">Categorías de Gastos</h5>
                            <div class="chart-container">
                                <canvas id="categoriasGastosChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12 mb-4">
                        <div class="finance-card card p-3">
                            <h5 class="card-title text-white">Tendencia de Ingresos y Gastos</h5>
                            <div class="chart-container">
                                <canvas id="tendenciaChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12 mb-3">
                        <button class="btn btn-info w-100" id="btnExportarReporte">
                            <i class="fas fa-file-export"></i> Exportar Reporte
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Tab de Facturas -->
            <div class="tab-pane fade" id="facturas" role="tabpanel" aria-labelledby="facturas-tab">
                <div class="row mb-3">
                    <div class="col-md-4">
                        <button class="btn btn-primary w-100" id="btnNuevaFactura">
                            <i class="fas fa-file-invoice"></i> Nueva Factura
                        </button>
                    </div>
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="text" class="form-control" id="buscarFactura" placeholder="Buscar factura...">
                            <select class="form-select" id="filtroEstadoFactura">
                                <option value="todos">Todos</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="pagada">Pagada</option>
                                <option value="cancelada">Cancelada</option>
                            </select>
                            <button class="btn btn-primary" type="button" id="btnBuscarFactura">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-dark table-bordered table-hover" id="tablaFacturas">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Fecha</th>
                                <th>Cliente</th>
                                <th>Monto</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Los datos se cargarán con JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Información de resultados y paginación para facturas -->
                <div class="row mt-3">
                    <div class="col-md-6">
                        <p class="text-white" id="infoResultadosFacturas">Mostrando 1 - 10 de 0 facturas</p>
                    </div>
                    <div class="col-md-6">
                        <div id="paginacionFacturas" class="d-flex justify-content-end"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal para Nueva Transacción (Ingreso o Gasto) -->
        <div class="modal fade" id="modalTransaccion" tabindex="-1" aria-labelledby="modalTransaccionLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTransaccionLabel">Nueva Transacción</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="formTransaccion">
                            <input type="hidden" id="transaccionId">
                            <input type="hidden" id="tipoTransaccion">
                            
                            <div class="mb-3">
                                <label for="descripcionTransaccion" class="form-label">Descripción</label>
                                <input type="text" class="form-control" id="descripcionTransaccion" required>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="categoriaTransaccion" class="form-label">Categoría</label>
                                    <select class="form-select" id="categoriaTransaccion" required>
                                        <!-- Las categorías se cargarán dinámicamente según el tipo -->
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="montoTransaccion" class="form-label">Monto</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control" id="montoTransaccion" step="0.01" min="0.01" required>
                                    </div>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="fechaTransaccion" class="form-label">Fecha</label>
                                    <input type="date" class="form-control" id="fechaTransaccion" required>
                                </div>
                                <div class="col-md-6" id="campoClienteTransaccion">
                                    <label for="clienteTransaccion" class="form-label">Cliente</label>
                                    <input type="text" class="form-control" id="clienteTransaccion">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="notasTransaccion" class="form-label">Notas</label>
                                <textarea class="form-control" id="notasTransaccion" rows="2"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="btnGuardarTransaccion">Guardar</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal para Nueva Factura -->
        <div class="modal fade" id="modalFactura" tabindex="-1" aria-labelledby="modalFacturaLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header border-secondary">
                        <h5 class="modal-title" id="modalFacturaLabel">Nueva Factura</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="formFactura">
                            <input type="hidden" id="facturaId">
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="numeroFactura" class="form-label">Número de Factura</label>
                                    <input type="text" class="form-control" id="numeroFactura" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="fechaFactura" class="form-label">Fecha</label>
                                    <input type="date" class="form-control" id="fechaFactura" required>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="clienteFactura" class="form-label">Cliente</label>
                                    <select class="form-select" id="clienteFactura" required>
                                        <option value="">Seleccione un cliente</option>
                                        <!-- Los clientes se cargarán con JavaScript -->
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="estadoFactura" class="form-label">Estado</label>
                                    <select class="form-select" id="estadoFactura" required>
                                        <option value="pendiente">Pendiente</option>
                                        <option value="pagada">Pagada</option>
                                        <option value="cancelada">Cancelada</option>
                                    </select>
                                </div>
                            </div>
                            
                            <h6 class="mt-4 mb-3">Detalles de la Factura</h6>
                            
                            <div class="table-responsive">
                                <table class="table table-dark table-bordered table-hover" id="tablaDetallesFactura">
                                    <thead>
                                        <tr>
                                            <th>Producto</th>
                                            <th>Cantidad</th>
                                            <th>Precio Unitario</th>
                                            <th>Subtotal</th>
                                            <th>Acción</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr id="filaAgregarDetalle">
                                            <td colspan="5">
                                                <button type="button" class="btn btn-success btn-sm w-100" id="btnAgregarDetalle">
                                                    <i class="fas fa-plus"></i> Agregar Producto
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="3" class="text-end"><strong>Total:</strong></td>
                                            <td colspan="2"><strong id="totalFactura">$0.00</strong></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            
                            <div class="mb-3">
                                <label for="notasFactura" class="form-label">Notas</label>
                                <textarea class="form-control" id="notasFactura" rows="2"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="btnGuardarFactura">Guardar</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal para Ver Factura Mejorado -->
        <div class="modal fade" id="modalVerFactura" tabindex="-1" aria-labelledby="modalVerFacturaLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content bg-dark text-white">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalVerFacturaLabel">Factura #<span id="verNumeroFactura"></span></h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-0">
                        <!-- Documento de factura con formato mejorado -->
                        <div class="container-fluid p-4 factura-documento">
                            <!-- Encabezado de la factura -->
                            <div class="row mb-4">
                                <div class="col-6">
                                    <h1 class="mb-3 text-primary">ERP Sistema</h1>
                                    <p class="mb-1">Calle Principal #123</p>
                                    <p class="mb-1">Ciudad, País CP 12345</p>
                                    <p class="mb-1">Tel: (123) 456-7890</p>
                                    <p>info@erpsistema.com</p>
                                </div>
                                <div class="col-6 text-end">
                                    <h2 class="mb-0 text-uppercase">FACTURA</h2>
                                    <h3 class="text-primary mb-3">#<span id="verNumeroFactura2"></span></h3>
                                    <p class="mb-1"><strong>Fecha de emisión:</strong> <span id="verFechaFactura"></span></p>
                                    <p class="mb-1"><strong>Fecha de vencimiento:</strong> <span id="verFechaVencimiento">30 días</span></p>
                                    <div class="mt-3">
                                        <span id="sello" class="badge rounded-pill bg-success p-2 fs-6">PAGADA</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Información del cliente -->
                            <div class="row mb-4">
                                <div class="col-12 bg-dark p-3 border">
                                    <h5>CLIENTE</h5>
                                    <p class="mb-1"><strong>Nombre:</strong> <span id="verClienteFactura"></span></p>
                                    <p class="mb-1"><strong>Dirección:</strong> <span id="verDireccionCliente">-</span></p>
                                    <p class="mb-0"><strong>Teléfono:</strong> <span id="verTelefonoCliente">-</span></p>
                                </div>
                            </div>
                            
                            <!-- Tabla de items -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="table-responsive">
                                        <table class="table table-striped border">
                                            <thead class="table-primary">
                                                <tr>
                                                    <th class="text-center" width="10%">#</th>
                                                    <th width="45%">Producto</th>
                                                    <th class="text-center" width="15%">Cantidad</th>
                                                    <th class="text-end" width="15%">Precio Unit.</th>
                                                    <th class="text-end" width="15%">Subtotal</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tablaVerDetallesFactura">
                                                <!-- Los detalles se cargarán con JavaScript -->
                                            </tbody>
                                            <tfoot class="table-light">
                                                <tr>
                                                    <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                                                    <td class="text-end"><span id="verSubtotalFactura">$0.00</span></td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4" class="text-end"><strong>IVA (19%):</strong></td>
                                                    <td class="text-end"><span id="verIvaFactura">$0.00</span></td>
                                                </tr>
                                                <tr class="table-primary">
                                                    <td colspan="4" class="text-end"><strong>TOTAL:</strong></td>
                                                    <td class="text-end"><strong id="verTotalFactura">$0.00</strong></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Notas y términos -->
                            <div class="row mb-2">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <strong>Notas</strong>
                                        </div>
                                        <div class="card-body">
                                            <p id="verNotasFactura" class="mb-0">Sin notas</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <strong>Términos y condiciones</strong>
                                        </div>
                                        <div class="card-body">
                                            <p class="small mb-0">Pago dentro de los 30 días posteriores a la recepción. El pago se puede realizar por transferencia bancaria o depósito a la cuenta especificada. Agradecemos su confianza en nuestros servicios.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Pie de página -->
                            <div class="row">
                                <div class="col-12 text-center border-top pt-3">
                                    <p class="small text-muted mb-0">Si tiene alguna pregunta sobre esta factura, contacte a: soporte@erpsistema.com</p>
                                    <p class="small text-muted mb-0">¡Gracias por su confianza!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-info" id="btnImprimirFactura">
                            <i class="fas fa-print"></i> Imprimir
                        </button>
                        <button type="button" class="btn btn-success" id="btnCambiarEstadoFactura">
                            <i class="fas fa-check-circle"></i> Marcar como Pagada
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer class="bg-dark text-white py-3 border-top border-secondary mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-md-12 text-center">
                    <p class="mb-0">&copy; <script>document.write(new Date().getFullYear())</script> Lextrack.</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>
    <script src="js/date-utils.js"></script>
    <script src="js/finanzas.js"></script>
</body>
</html>